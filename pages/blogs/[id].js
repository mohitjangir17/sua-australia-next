import Head from "next/head";
import homestyles from "../../styles/Home.module.css";
import styles from "../../styles/BlogId.module.css";
import Navbar from "../../components/layout/Navbar";
import Link from "next/link";
import UploadForm from "../../components/UploadForm";
import SidebarList from "../../components/SidebarList";
import useSWR from "swr";
import { useRouter } from "next/router";
import Image from "next/image";

export const getStaticPaths = async () => {
  const res = await fetch("https://api.swipeupassignments.com/blogs");
  const data = await res.json();
  // console.log(data.data);
  const paths = data.data.map((blog) => {
    return {
      params: { id: blog.id.toString() },
    };
  });
  // console.log(paths);
  return {
    paths,
    fallback: false,
  };
};
export const getStaticProps = async (context) => {
  const id = context.params.id;
  const res = await fetch("https://api.swipeupassignments.com/blogs/" + id);
  const data = await res.json();
  return {
    props: { blog: data },
  };
};
export default function IndividualBlog({ blog }) {
  const router = useRouter();
  const localizedString = router.asPath;
  const { data } = useSWR(
    `/api/page_views?slug=${encodeURIComponent(localizedString)}`,
    async (url) => {
      const res = await fetch(url);
      return res.json();
    },
    { revalidateOnFocus: false }
  );
  const views = data?.pageViews || 0;
  return (
    <>
      <Head>
        <title>{blog.title} | SUA-Australia</title>
        <meta name="Assignment Query" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className={styles.HeaderOtherPages}>
        <div
          style={{
            backgroundImage: `url(${blog.thumbnail})`,
          }}
          className={styles.headerotherOverlay}
        ></div>
        <Navbar />
        <div className={styles.pageIndicator}>
          <h3>
            <Link href="/">Home/ </Link>
            <span>blog</span>
          </h3>
          <h1>{blog.title}</h1>
        </div>
      </div>
      <main className={homestyles.mainContainer}>
        <section className={styles.blogFlexbox}>
          <article className={styles.blogDataContainer}>
            {" "}
            <p>{new Date(blog.createdAt).toDateString()}</p>{" "}
            <div dangerouslySetInnerHTML={{ __html: blog.description }}></div>
            <h4>{views} Views</h4>
          </article>
          <article className={styles.sideBar}>
            <UploadForm />
            <SidebarList />
          </article>
        </section>
      </main>
    </>
  );
}
